<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>给 Ketiny 的小网站</title>

<style>
:root{
  --bg1:#070a12;
  --bg2:#0b0f1d;
  --bg3:#11162e;
  --card:rgba(255,255,255,.07);
  --line:rgba(255,255,255,.14);
  --text:#eaf0ff;
  --muted:rgba(234,240,255,.72);
  --pink:#ff6fb1;
  --purple:#b78cff;
  --blue:#74b2ff;
  --sky:#8fd6ff;
  --r:18px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Microsoft YaHei",Arial,sans-serif;
  color:var(--text);
  background:
    radial-gradient(1000px 500px at 10% -10%, rgba(116,178,255,.25), transparent 60%),
    radial-gradient(900px 500px at 90% 10%, rgba(255,111,177,.18), transparent 60%),
    linear-gradient(180deg,var(--bg1),var(--bg2) 50%,var(--bg3));
  min-height:100vh;
}

.container{max-width:1200px;margin:auto;padding:16px}
a{text-decoration:none;color:inherit}

header{
  position:sticky;top:0;z-index:9;
  backdrop-filter:blur(10px);
  background:rgba(7,10,18,.7);
  border-bottom:1px solid var(--line);
}
.nav{display:flex;justify-content:space-between;align-items:center}
.brand{display:flex;align-items:center;gap:10px;font-weight:900}
.logo{
  width:34px;height:34px;border-radius:14px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  position:relative;
}
.logo::after{
  content:"";
  position:absolute;inset:0;
  background:
    radial-gradient(circle at 65% 40%,var(--pink) 0 18%,transparent 19%),
    radial-gradient(circle at 40% 40%,var(--pink) 0 18%,transparent 19%);
}

.tabs{display:flex;gap:10px;justify-content:center;margin-top:8px;flex-wrap:wrap}
.tab{
  padding:10px 16px;border-radius:999px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.06);
  cursor:pointer;
}
.tab.active{
  background:linear-gradient(135deg,var(--pink),var(--purple));
  color:#111;
  font-weight:900;
}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--r);
  padding:18px;
  margin-top:16px;
}

.section-title{font-size:22px;font-weight:900;margin:0}
.small{font-size:12px;color:var(--muted)}

textarea{
  width:100%;min-height:140px;
  background:rgba(0,0,0,.25);
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  color:var(--text);
}

.btn{
  margin-top:12px;
  padding:10px 18px;
  border-radius:14px;
  border:none;
  background:linear-gradient(135deg,var(--pink),var(--purple));
  font-weight:900;
  cursor:pointer;
  color:#111;
}

/* hello kitty bow touch */
.kitty-btn{position:relative}
.kitty-btn::after{
  content:"";
  position:absolute;
  right:10px; top:10px;
  width:10px;height:10px;
  border-radius:4px;
  background:var(--pink);
  box-shadow:10px 0 0 0 var(--pink);
  opacity:.85;
}
.kitty-btn::before{
  content:"";
  position:absolute;
  right:15px; top:13px;
  width:8px;height:8px;
  border-radius:50%;
  background:rgba(255,255,255,.65);
  opacity:.45;
}

/* schedule header */
.schedule-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:14px;
  flex-wrap:wrap;
}
.worktime{
  margin-top:10px;
  color:var(--muted);
  font-size:13px;
  line-height:1.8;
}
.worktime-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.today-mini{
  margin-top:0;
  padding:8px 14px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  background:linear-gradient(135deg,var(--pink),var(--purple));
  font-weight:900;
  color:#111;
  white-space:nowrap;
}

/* month dropdown */
.monthbar{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.monthbtn{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.05);
  border-radius:14px;
  padding:10px 14px;
  font-weight:900;
  color:var(--text);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:10px;
}
.monthbtn .arrow{
  display:inline-grid;
  place-items:center;
  width:26px;height:26px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.18);
  font-size:16px;
  line-height:1;
}
.monthmenu{
  position:relative;
}
.monthlist{
  position:absolute;
  right:0;
  top:52px;
  width:180px;
  padding:10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(7,10,18,.92);
  backdrop-filter:blur(10px);
  display:none;
  z-index:50;
}
.monthlist.open{display:grid}
.monthlist{
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}
.mitem{
  text-align:center;
  padding:10px 0;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.04);
  cursor:pointer;
  font-weight:900;
  color:var(--text);
}
.mitem.active{
  background:linear-gradient(135deg,var(--pink),var(--purple));
  color:#111;
  border-color:transparent;
}

.weekday{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(7, 1fr);
  gap:10px;
  color:var(--muted);
  font-size:12px;
}
.weekday div{
  text-align:center;
  padding:10px 0;
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  background:rgba(0,0,0,.10);
}
.weekday .sun, .weekday .sat{ color:#ff6b6b; }

.calendar{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
}
.day{
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:12px;
  min-height:78px;
  background:rgba(0,0,0,.12);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.day.empty{ visibility:hidden; }
.dnum{ font-weight:900; font-size:16px; }
.dshift{
  margin-top:8px;
  font-size:13px;
  font-weight:900; /* 班次加粗 */
  color:rgba(234,240,255,.86);
}

/* rest day */
.day.rest{
  background:linear-gradient(135deg,var(--sky),#bdeaff);
  border-color:rgba(0,0,0,.08);
}
.day.rest .dshift,
.day.rest .dnum{
  color:#003a5c;
}

/* today highlight (2s) */
.day.todayFlash{
  outline:2px solid var(--pink);
  box-shadow:0 0 0 8px rgba(255,111,177,.10);
}

footer{
  text-align:center;
  margin:30px 0;
  color:var(--muted);
  font-size:12px;
}

@media (max-width: 520px){
  .container{padding:12px}
  .weekday{gap:8px}
  .calendar{gap:8px}
  .day{min-height:70px; padding:10px}
  .dnum{font-size:15px}
  .dshift{font-size:12px}
  .monthbtn{padding:10px 12px}
}
</style>
</head>

<body>
<header>
  <div class="container nav">
    <div class="brand">
      <div class="logo"></div>
      给 Ketiny 的小网站
    </div>
  </div>
  <div class="tabs container">
    <div class="tab" data-p="wish">心愿单</div>
    <div class="tab" data-p="bin">坏情绪回收站</div>
    <div class="tab active" data-p="schedule">班表</div>
  </div>
</header>

<main class="container">
  <section id="wish" style="display:none">
    <div class="card">
      <div class="section-title">心愿单</div>
      <textarea id="wishText" placeholder="写下你想要的，我会收到。"></textarea>
      <button class="btn kitty-btn" onclick="sendWish()">发送</button>
    </div>
  </section>

  <section id="bin" style="display:none">
    <div class="card">
      <div class="section-title">坏情绪回收站</div>
      <textarea id="binText" placeholder="把不开心的写下来，交给我。"></textarea>
      <button class="btn kitty-btn" onclick="sendBin()">消灭</button>
    </div>
  </section>

  <section id="schedule">
    <div class="card">
      <div class="schedule-head">
        <div>
          <div class="section-title">班表</div>
          <div class="worktime">
            <div>早班 <b>07:00-15:00</b> ｜ 中班 <b>15:00-23:00</b></div>
            <div class="worktime-row">
              <div>晚班 <b>23:00-07:00</b> <span class="small">(前一天 23:00 开始)</span></div>
              <button class="today-mini kitty-btn" id="goToday">今日</button>
            </div>
          </div>
        </div>

        <div class="monthbar">
          <div class="monthmenu">
            <button class="monthbtn kitty-btn" id="monthBtn" aria-label="选择月份">
              <span id="monthLabel">2026年 1月</span>
              <span class="arrow">▾</span>
            </button>
            <div class="monthlist" id="monthList"></div>
          </div>
        </div>
      </div>

      <div class="weekday" id="weekdayRow"></div>
      <div class="calendar" id="calendar"></div>
    </div>
  </section>

  <footer>ketiny越来越好</footer>
</main>

<script>
/* ====== Formspree（保留你的设置） ====== */
const ENDPOINT="https://formspree.io/f/xjgkljor";
function $(id){return document.getElementById(id);}

async function send(type,text,msg){
  const content=(text||"").trim();
  if(!content){ alert("内容不能为空"); return; }
  try{
    const res=await fetch(ENDPOINT,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({type,content,time:new Date().toLocaleString()})
    });
    if(!res.ok) throw new Error("HTTP "+res.status);
    alert(msg);
  }catch(e){
    alert("发送失败，请检查网络后重试");
  }
}
function sendWish(){send("心愿",$("wishText").value,"柱子已接旨")}
function sendBin(){send("坏情绪",$("binText").value,"坏情绪已传递，等待柱子来铲除")}

/* ====== 2026 排班生成（严格符合你给的规则并可延续全年） ======
   规则锚点：
   2026-01-01 ~ 01-05：早班（5天）
   从 01-06 开始：休2天(N) -> 上6天（班次轮换：中 -> 晚 -> 早 -> 中 ...）-> 休2天(N) -> ...
   这样自然得到：2026-02-01~02-06 为中班
*/
function pad2(n){return String(n).padStart(2,"0");}
function keyOf(d){return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;}

function buildShiftMap2026(){
  const map = {};
  const start = new Date(2026,0,1);
  const end   = new Date(2026,11,31);

  // 1) 1/1-1/5 早班
  let d = new Date(start);
  for(let i=0;i<5;i++){
    map[keyOf(d)]="早班";
    d.setDate(d.getDate()+1);
  }

  // 2) 从 1/6 起：休2天 -> 上6天（中/晚/早轮换）-> 休2天 ...
  const rotate = ["中班","晚班","早班"]; // 按你 1 月规则：1/8-13 中班，1/16-21 晚班，1/24-29 早班
  let idx=0;

  while(d<=end){
    // 休2天
    for(let r=0;r<2 && d<=end;r++){
      map[keyOf(d)]="N";
      d.setDate(d.getDate()+1);
    }
    // 上6天
    for(let w=0; w<6 && d<=end; w++){
      map[keyOf(d)] = rotate[idx % rotate.length];
      d.setDate(d.getDate()+1);
    }
    idx++;
  }

  return map;
}
const shiftMap2026 = buildShiftMap2026();

/* ====== 月份控件（只允许 2026） ====== */
const WEEKDAYS = ["日","一","二","三","四","五","六"];
function renderWeekdayRow(){
  const row=$("weekdayRow");
  row.innerHTML="";
  WEEKDAYS.forEach((w,i)=>{
    const div=document.createElement("div");
    div.textContent=w;
    if(i===0) div.classList.add("sun");
    if(i===6) div.classList.add("sat");
    row.appendChild(div);
  });
}
renderWeekdayRow();

function daysInMonth(y, mIndex){ return new Date(y, mIndex+1, 0).getDate(); }

let viewYear = 2026;
let viewMonth = 0; // 0-11

function setMonthLabel(){
  $("monthLabel").textContent = `${viewYear}年 ${viewMonth+1}月`;
  // month list active
  document.querySelectorAll(".mitem").forEach(el=>{
    el.classList.toggle("active", Number(el.dataset.m)===viewMonth);
  });
}

function renderCalendar(){
  setMonthLabel();
  const cal=$("calendar");
  cal.innerHTML="";

  const first = new Date(viewYear, viewMonth, 1);
  const firstDow = first.getDay();
  const total = daysInMonth(viewYear, viewMonth);

  for(let i=0;i<firstDow;i++){
    const empty=document.createElement("div");
    empty.className="day empty";
    cal.appendChild(empty);
  }

  const now=new Date();
  const todayKey = keyOf(now);

  for(let day=1; day<=total; day++){
    const d = new Date(viewYear, viewMonth, day);
    const k = keyOf(d);
    const s = shiftMap2026[k] || "";

    const box=document.createElement("div");
    box.className="day";
    if(s==="N") box.classList.add("rest");
    if(k===todayKey) box.classList.add("today");

    const num=document.createElement("div");
    num.className="dnum";
    num.textContent=day;

    const shiftEl=document.createElement("div");
    shiftEl.className="dshift";
    shiftEl.textContent=s;

    box.appendChild(num);
    box.appendChild(shiftEl);
    cal.appendChild(box);
  }
}

/* month dropdown build */
function buildMonthList(){
  const list=$("monthList");
  list.innerHTML="";
  for(let m=0;m<12;m++){
    const b=document.createElement("button");
    b.type="button";
    b.className="mitem";
    b.dataset.m = String(m);
    b.textContent = `${m+1}月`;
    b.onclick=()=>{
      viewMonth = m;
      list.classList.remove("open");
      renderCalendar();
    };
    list.appendChild(b);
  }
}
buildMonthList();
setMonthLabel();

$("monthBtn").onclick=()=>{
  $("monthList").classList.toggle("open");
};
document.addEventListener("click",(e)=>{
  const menu=document.querySelector(".monthmenu");
  if(!menu.contains(e.target)){
    $("monthList").classList.remove("open");
  }
});

/* 今日按钮：切当月 + 高亮当天 2 秒 */
$("goToday").onclick=()=>{
  const now=new Date();
  if(now.getFullYear()!==2026){
    // 不允许跳到 2025/2027；如果当前不是 2026，就跳到 2026-01
    viewYear=2026; viewMonth=0;
    renderCalendar();
    return;
  }
  viewYear=2026;
  viewMonth=now.getMonth();
  renderCalendar();

  const cal=$("calendar");
  const todayEl = cal.querySelector(".day.today");
  if(todayEl){
    todayEl.classList.add("todayFlash");
    todayEl.scrollIntoView({behavior:"smooth", block:"center"});
    setTimeout(()=>todayEl.classList.remove("todayFlash"), 2000);
  }
};

/* tabs */
document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{
    ["wish","bin","schedule"].forEach(id=>{ $(id).style.display="none"; });
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    $(t.dataset.p).style.display="block";
    if(t.dataset.p==="schedule"){
      renderCalendar();
    }
  };
});

/* init */
renderCalendar();
</script>
</body>
</html>
